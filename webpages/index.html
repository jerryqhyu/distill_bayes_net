<!doctype html>
<meta charset="utf-8">
<script src="https://distill.pub/template.v1.js"></script>

<dt-article>

<svg width="960" height="673" stroke="#fff" stroke-width="0.5"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-hsv.v0.1.min.js"></script>
<script src="https://d3js.org/d3-contour.v1.min.js"></script>
<script src="assets/iterates.js"></script>

<div id="sliderAlpha" style="position:absolute; width:300px; height: 50px; left:20px; top: 320px;">
     <text class="figtext" style="top: -5px; left: 20px; position: relative;">Step-size α = 0.02</text>
   </div>
   <div id="sliderBeta" style="position:absolute; width: 300px; height: 50px; left: 280px; top: 320px;;">
     <text class="figtext" style="top: -5px; left: 20px; position: relative;">Momentum β = 0.99</text>
</div>

<script>

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

var i0 = d3.interpolateHsvLong(d3.hsv(120, 1, 0.65), d3.hsv(60, 1, 0.90)),
    i1 = d3.interpolateHsvLong(d3.hsv(60, 1, 0.90), d3.hsv(0, 0, 0.95)),
    interpolateTerrain = function(t) { return t < 0.5 ? i0(t * 2) : i1((t - 0.5) * 2); },
    color = d3.scaleSequential(interpolateTerrain).domain([90, 190]);

d3.json("volcano.json", function(error, volcano) {
  if (error) throw error;

  svg.selectAll("path")
    .data(d3.contours()
        .size([volcano.width, volcano.height])
        .thresholds(d3.range(90, 195, 5))
      (volcano.values))
    .enter().append("path")
      .attr("d", d3.geoPath(d3.geoIdentity().scale(width / volcano.width)))
      .attr("fill", function(d) { return color(d.value); });
});

var slidera = sliderGen([230, 40])
            .ticks([0,0.003,0.006])
            .ticktitles( function(d,i) { return ["0", "0.003", "0.006"][i]})
            .change( function (i) {
              d3.select("#sliderAlpha").selectAll(".figtext").html("Step-size α = " + getalpha().toPrecision(2) )
              iterChange(getalpha(), getbeta(), getw0() )
            } )
            .startxval(0.003)
            .cRadius(7)
            .shifty(-12)
            .margins(20,20)
var sliderb = sliderGen([230, 40])
            .ticks([0,0.5,0.99])
            .change( function (i) {
              d3.select("#sliderBeta").selectAll(".figtext").html("Momentum β = " + getbeta().toPrecision(2) )
              iterChange(getalpha(), getbeta(), getw0() )
            } )
            .cRadius(7)
            .shifty(-12)
            .startxval(0.74)
            .margins(20,20)
var getalpha = slidera( d3.select("#sliderAlpha")).xval
var getbeta  = sliderb( d3.select("#sliderBeta")).xval

</script>

</dt-article>
